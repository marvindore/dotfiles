#Linux set sudo path to user path
#https://stackoverflow.com/questions/12996397/command-not-found-when-using-sudo
alias mudo='sudo -E env "PATH=$PATH"'

alias copyq='flatpak run com.github.hluk.copyq'
alias flatseal='flatpak run com.github.tchx84.Flatseal'
alias flameshot='env QT_SCREEN_SCALE_FACTORS="1;1.5;" flatpak run org.flameshot.Flameshot gui'
alias upgradedistrobox='curl -s https://raw.githubusercontent.com/89luca89/distrobox/main/install | sudo sh -s -- --next'
alias flake='nvim ~/.config/nix-darwin/'
alias msbuild='$HOME/.local/share/mise/shims/dotnet'
alias MSBuild='$HOME/.local/share/mise/shims/dotnet'

#git

#Php
alias sail='[ -f sail ] && bash sail || bash vendor/bin/sail'

# Python
alias py="python3"
#alias python="python3"

# Vim
alias vd="nvim -d"
alias nv="nvim"
alias sv="sudo nvim"
alias v="nvim"
alias zj="zellij"
alias zjn="zellij -s"

alias l="eza"

alias wiki="nvim ~/vimwiki/index.md"

# --- Start Kanata + Virtual HID daemon ---
function kanata_up() {
    # Check if karabiner_cli exists in PATH
    if ! command -v karabiner_cli >/dev/null 2>&1; then
        echo "Karabiner-Elements CLI not found â€” please install/start Karabiner-Elements first."
        return 1
    fi

    echo "Karabiner-Elements CLI detected."

    # Optional: wait a short moment for Karabiner to initialize
    sleep 0.5

    echo "Starting Kanata..."
    sudo nohup kanata --cfg "$HOME/.config/kanata/config.kbd" \
        >> /tmp/kanata.log 2>&1 &
    echo $! | sudo tee /tmp/kanata-kanata.pid >/dev/null

    echo "Kanata started!"
}

# --- Stop Kanata ---
function kanata_down() {
    echo "Stopping Kanata..."

    # Kill any process named 'kanata'
    sudo pkill -x kanata 2>/dev/null || true

    # Kill any process containing 'kanata' in the command line
    sudo pkill -f "kanata" 2>/dev/null || true

    # Kill any remaining child processes Kanata spawned
    for pid in $(pgrep -f "kanata"); do
        sudo kill -9 "$pid" 2>/dev/null || true
    done

    # Remove PID files
    sudo rm -f /tmp/kanata.pid /tmp/kanata-kanata.pid

    echo "Kanata stack stopped."
}

# --- Check status ---
function kanata_status() {
    echo "Kanata:"
    pgrep -fl "kanata --cfg" || echo "not running"

    echo "Karabiner-Elements:"
    if command -v karabiner_cli >/dev/null 2>&1; then
        echo "installed"
    else
        echo "not installed / not found"
    fi
}

function darwin-update() {
  echo "Building system configuration as unprivileged user..."
  nix build ~/.config/nix-darwin#darwinConfigurations.mchip.system

  if [ $? -eq 0 ]; then
    # this step doesn't need the full path darwinConfigurations.mchip.system
    # similarly the darwin-rebuild command looks up the systemconfiguration on its own.

    echo "Build successful. Switching system configuration as root..."
    sudo darwin-rebuild switch --flake ~/.config/nix-darwin#mchip
  else
    echo "Nix build failed. Aborting switch."
  fi
}

function cht() {
# :list
# :learn
# sub topic
    if [ -z "$1" ]; then
        lang=$(curl -s cht.sh/:list | fzf)
    else
        lang="$1"
    fi

    [ -z "$lang" ] && return

    topic=$(
      {
        echo "ALL"
        curl -s "cht.sh/$lang/:list"
      } | fzf
    )

    [ -z "$topic" ] && return

    if [[ "$topic" == "ALL" ]]; then
      curl -s "cht.sh/$lang" | bat
    else
      curl -s "cht.sh/$lang/$topic" | bat
    fi
}
