{{- if eq .chezmoi.os "windows" -}}
# Chezmoi Windows script: set XDG_CONFIG_HOME (User) only if missing.
$Name    = "XDG_CONFIG_HOME"
$Scope   = "User"
$Desired = Join-Path $env:USERPROFILE ".config"

try {
    $Current = [Environment]::GetEnvironmentVariable($Name, $Scope)
    if ([string]::IsNullOrWhiteSpace($Current)) {
        if (-not (Test-Path -LiteralPath $Desired)) {
            [System.IO.Directory]::CreateDirectory($Desired) | Out-Null
        }
        [Environment]::SetEnvironmentVariable($Name, $Desired, $Scope)
        Write-Host "Set XDG_CONFIG_HOME (User) to: $Desired"
        Write-Host "NOTE: Restart shells/IDEs for new processes to pick it up."
    }
    else {
        Write-Host "XDG_CONFIG_HOME (User) already set: $Current â€” no change."
    }
}
catch {
    Write-Warning "Failed to set XDG_CONFIG_HOME: $($_.Exception.Message)"
    exit 1
}
{{- end -}}
